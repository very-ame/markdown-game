# Markdown Adventure
[Markdown AI](https://mdown.ai/)を利用して制作するノベルゲームです。[公開ページ](https://mdown.ai/content/64eca81b-329b-4811-a107-4eea93eb870b)から遊んでみてください。[Qiita記事](https://qiita.com/very-much/items/1a1f8da34b516a2d27bc)も公開中です。

## how to use
Markdown AIの編集ページに、`main.txt`の内容と`style_and_script.html`の内容を順に貼り付けます。
Markdown AIでは直打ちのマークダウンをサポートしていることもあり、HTML本文のインデントなどに厳しいです。勝手にフォーマッティングされないように`.txt`ファイルとして保管しています。

`style_and_script.html`の`<id-for-your-ai>`部分を編集する必要があります。取得したAIモデルのIDを貼り付けてください。
```
response = await serverAI.getAnswerText("<id-for-your-ai>", "", promptToAI);
```

## AI model
私は`gpt-4o-mini`モデルで、以下のようなプロンプトを設定していました。プロンプト内に半角のブラケット(`{`, `}`)を利用できないようなので、少し汚い実装になっています。

```
ストーリーを作成してください。

ルール
- 物語のお題は自由です。
- 一人称の視点の物語で、主人公以外にも登場人物が存在します。主人公の名前は明らかにせず、他者が主人公を呼ぶ際にも「あなた」「君」などを利用します。必ず、主人公の名前は勝手につけないようにして、一人称視点の物語にするようにしてください。主人公が話すときには、"あなた「...」"のように、話者の名前は「あなた」にしてください。
- 誰かが話すときは、"〇〇(キャラクター名)「...」"のように、誰が話したか明確になるようにしてください。
- 物語は、第一章、第二章、第三章に分かれています。第一章は始まり、第二章は展開、第三章は結末です。
- 第一章、第二章は10つの「文章」と、1つの「行動選択の質問」からなります。10つの「文章」は、主人公視点の地の文、あるいは他のキャラクターのセリフです。「行動選択の質問」は、それまでの物語の流れをくんで、主人公が次にどうするべきかを選択するパートです。
- 第三章は結末なので、11つの「文章」のみからなります。「行動選択の質問」は必要なく、全てが「文章」です。物語を終了させてください。
- 出力の形式はJSON.parseで読めるような、ただのStringにしてください。決してコードブロックを用いず、ただの文字列の型で辞書を返してください。第一章、第二章について、キーは"0"から"10"の数字で、"0"から"9"が順に7つの「文章」、"10"が「行動選択の質問」です。第三章については「行動選択の質問」が不必要なので、"0"から"10"の全てのキーに対してストーリーを記述する「文章」となります。

以下に出力の例を示します。これは第一章の例であることに注意してください。物語の序盤が記述され、また、ルールの通りにキーは"0"から"10"であることが分かると思います。
以下の例では、このプロンプトの入力形式の都合上、半角のブラケットではなく、全角のブラケットを用いています。実際にはJSON.parseで出力を直接読めるように、json形式をStringにしたもので出力してください。消して全角のブラケット（"｛"や"｝"）を用いないでください。

｛"0": "突然のにわか雨。私は木の下に駆け込んで雨宿りをしていた。", "1": "あなた「最悪…。お気に入りの服なのに。」", "2": "木の下でひとりたたずむ私。降り出したばかりだから雨がしのげているけど、激しくなってきたらここじゃ雨宿りにならない。どこか別の場所を探さなきゃ…。そんなことを考えていると、不意に私に話しかけてくる声がした。", "3": "大園「こんなところで何してんの？濡れてんじゃん。」", "4": "あなた「なんでいるんですか？」", "5": "大園「たまたま通りかかっただけだよ。傘、入っていく？」", "6": "彼は大学の先輩の大園さん。なぜかいつも私の前に現れる、謎の存在。最近、私が少し彼のことが気になっている。", "7": "あなた「いいえ、大丈夫です。悪いですし、その傘に二人入ったらふたりとも濡れちゃいます。」", "8": "大園さんのことは気になっていたが、いきなり相合傘する気にはなれなかった。", "9": "大園「気にすんなって。雨はしばらく止まないみたいだし、せっかく会ったのにここで置いてくのも薄情でしょ。」", "10": "...彼の傘の中に入っていこうかな？"｝

上の例では、恋愛に関するトピックです。女性の主人公がおり、「大園」という他のキャラクターがいることが分かると思います。あなたが生成するストーリーは、必ずしもテーマが恋愛である必要ではなく、他のキャラクターが「大園」という名前である必要はありません。

ストーリーに関する指定が次にあります。これらを守ってください。
- 陳腐なストーリーではなく、ユニークであり、かつぶっ飛びすぎず、3章でまとまるようにしてください。
- 第一章はストーリーのはじまり、第二章はそこからの展開、第三章は結末です。平坦で起伏のないものにならないように、ちゃんとアップダウンをつけてください。
- 説明口調の文章は避けてください。文学的な文章であることが好まれますが、難解すぎるものは避けてください。
- テーマはあなたに任せますが、「恋愛」「日常のちょっとした冒険」「旅行先での出来事」「主人公が猫であるようなほのぼのストーリー」などが好まれます。
- 一人称の視点の物語で、主人公以外にも登場人物が存在します。主人公の名前は明らかにせず、他者が主人公を呼ぶ際にも「あなた」「君」などを利用します。必ず、主人公の名前は勝手につけないようにして、一人称視点の物語にするようにしてください。
- 読みやすさのため、誰かが話すときは、"〇〇(キャラクター名)「...」"のように、誰が話したか明確になるようにしてください。主人公が話すときには、"あなた「...」"のように、話者の名前は「あなた」にしてください。

念を押しますが、出力の形式は辞書形式にしてください。第一章、第二章について、キーは"0"から"10"の数字で、"0"から"9"が順に7つの「文章」、"10"が「行動選択の質問」です。第三章では、"0"から"10"の数字のキーに対して全てがストーリーを記述する「文章」です。
```
